# Database Schema

MongoDB collections and structure.

## Collections

### 1. users
Admin accounts.

```javascript
{
  _id: ObjectId,
  email: String,           // unique
  password: String,        // bcrypt hashed
  role: String,            // "admin" or "user"
  name: String,
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes**: `email` (unique)

---

### 2. categories
Product categories.

```javascript
{
  _id: ObjectId,
  name: String,            // e.g. "Burgers"
  slug: String,            // e.g. "burgers" (unique)
  description: String,
  isActive: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes**: `slug` (unique)

---

### 3. products
Menu items.

```javascript
{
  _id: ObjectId,
  name: String,
  slug: String,            // unique, URL-friendly
  description: String,
  priceUSD: Number,        // decimal (e.g. 8.99)
  image: String,           // URL or path
  categoryId: ObjectId,    // references categories._id
  tags: [String],          // e.g. ["spicy", "vegan"]
  isActive: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes**: `slug` (unique), `categoryId`

---

### 4. promotions
Special offers and banners.

```javascript
{
  _id: ObjectId,
  title: String,
  description: String,
  bannerImage: String,
  startsAt: Date,          // promotion start
  endsAt: Date,            // promotion end
  appliesTo: [String],     // product slugs or "all"
  isActive: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

---

### 5. orders
Customer orders.

```javascript
{
  _id: ObjectId,
  orderNumber: String,     // unique, auto-generated
  sessionId: String,       // guest session ID
  items: [
    {
      productId: ObjectId,
      name: String,
      priceUSD: Number,
      quantity: Number
    }
  ],
  totalUSD: Number,
  customerName: String,
  customerPhone: String,
  customerEmail: String,
  deliveryAddress: String,
  status: String,          // "pending", "preparing", "ready", "delivered", "cancelled"
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes**: `orderNumber` (unique), `sessionId`, `status`

---

### 6. cart_items
Guest shopping cart (temporary).

```javascript
{
  _id: ObjectId,
  sessionId: String,       // guest session ID
  productId: ObjectId,
  quantity: Number,
  addedAt: Date
}
```

**Indexes**: `sessionId`

---

### 7. mood_questions
Quiz questions for AI recommendations.

```javascript
{
  _id: ObjectId,
  text: String,            // e.g. "How are you feeling today?"
  type: String,            // "single" or "multiple"
  options: [
    {
      value: String,       // e.g. "happy"
      label: String        // e.g. "Happy & Energetic"
    }
  ],
  order: Number,           // display order
  isActive: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes**: `order`

---

## Relationships

```
categories (1) ──< (N) products
products (N) ──< (N) cart_items
products (N) ──< (N) orders.items
```

- **categoryId**: Products belong to one category
- **productId**: Cart items and order items reference products
- **sessionId**: Cart and orders linked to guest sessions

---

## Seeding

Run `db/seed.js` to populate sample data:

```bash
cd db
node seed.js
```

**Seeds**:
- 1 admin user (`admin@fastspot.com` / `admin123`)
- 6 categories (Burgers, Drinks, Sides, Desserts, Salads, Combos)
- 20+ products
- 3 mood questions
- 2 sample promotions

---

## Indexes Summary

```javascript
// users
db.users.createIndex({ email: 1 }, { unique: true })

// categories
db.categories.createIndex({ slug: 1 }, { unique: true })

// products
db.products.createIndex({ slug: 1 }, { unique: true })
db.products.createIndex({ categoryId: 1 })

// orders
db.orders.createIndex({ orderNumber: 1 }, { unique: true })
db.orders.createIndex({ sessionId: 1 })
db.orders.createIndex({ status: 1 })

// cart_items
db.cart_items.createIndex({ sessionId: 1 })

// mood_questions
db.mood_questions.createIndex({ order: 1 })
```

---

## Connection

**URI**: `mongodb://localhost:27017`  
**Database**: `fastspot`

Configure in `backend/.env`:

```env
MONGO_URI=mongodb://localhost:27017
DB_NAME=fastspot
```

---

## Notes

- All dates stored as `ISODate` (UTC)
- ObjectIDs used for relations (no foreign keys)
- Soft deletes not implemented (hard delete via API)
- Cart items cleaned up manually (no TTL index)
- Session IDs generated by frontend (`guest_<random>`)

